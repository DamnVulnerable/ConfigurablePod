# Configurable Pod Operator

This operator showcases a new hacking technique against kubernetes custom controllers.

## Setup

Create a new secret with the following command:

```bash
kubectl apply -f - <<EOF
apiVersion: v1
kind: Secret
metadata:
  name: production-config
type: Opaque
data:
  image: bmdpbng=
EOF
```

Install the operator with the following command:

```bash
helm install configurablepod ./helm
```

Create a new configurable pod from the client deployment:

```bash
kubectl apply -f - <<EOF
apiVersion: damnvulerable.io/v1
kind: ConfigurablePod
metadata:
  name: example-configurablepod
spec:
  template:
    metadata:
      labels:
        app: example
    spec:
      containers:
      - name: example-container
        image: secret:default:production-config:image
EOF
```

Check the image of the pod generated by the operator:

```bash
kubectl get pod example-configurablepod -o jsonpath='{.spec.containers[0].image}'
```

> **Note:** The image of the pod comes from the secret created before which the client is not allowed to read.
